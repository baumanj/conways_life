<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Demo</title>
    <style type="text/css">
        td {
            border: 1px solid black;
            width: 50px;
            height: 50px;
        }
        td.live {
            background-color: green;
        }
    </style>
</head>
<body>
    <button type="button" onclick="getNextGeneration()">Next generation!</button>
    <button type="button" onclick="addRow()">Add row</button>
    <button type="button" onclick="addCol()">Add column</button>
    <table>
        <tr>
            <td></td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
            <td></td><td></td><td></td><td></td><td></td>
        </tr>
    </table>
    <script src="jquery-2.1.4.min.js"></script>
    <script>
    $(document).on('click', 'td' , function() {
        $( this ).toggleClass( "live" );
    });

    function adjuctCellSize() {
        $("td").css("height", (50.0 * 5 / $("tr").length) + "px");
        $("td").css("width", (50.0 * 5 / $("tr")[0].children.length) + "px");
    }

    function addRow() {
        var cells = "";
        for (c = 0; c < $("tbody").children()[0].children.length; c++) {
            cells += "<td></td>";
        }
        $("tbody").append("<tr>" + cells + "</tr>");
        adjuctCellSize();
    }

    function addCol() {
        $("tr").append("<td></td>");
        adjuctCellSize();
    }

    function getNextGeneration() {
        var liveCells = []
        for (r = 0; r < $( "tbody" ).children().length; r++) {
            var row = $( "tbody" ).children()[r];

            for (c = 0; c < row.children.length; c++) {
                if (row.children[c].className == "live") {
                    liveCells.push([r, c]);
                }
            }
        }
        console.dir(liveCells);

        // var liveCells = [[2,1],[2,2],[2,3]];
        var data = {
            'M': 5,
            'N': 5,
            'liveCells' : liveCells
        };

        $.ajax({
            url: 'http://localhost:4567/succ',
            jsonp: 'callback',
            dataType: 'jsonp',
            data: data,
            success: function(response) {
                drawGeneration(response);
                // alert("yay, success!");
                // console.dir(response)
            },
            error: function( xhr, status, errorThrown ) {
                alert("Sorry, there was a problem!");
                console.log("Error: " + errorThrown);
                console.log("Status: " + status);
                console.dir(xhr);
            }
        });
    }

    function drawGeneration(response) {
        $("td").removeClass("live");
        for (i = 0; i < response.length; i++) {
            var row = response[i][0];
            var col = response[i][1];

            if (row < 0 || col < 0) {
                console.log("negative index: " + row + ", " + col);
                continue;
            }

            while (row >= $("tbody").children().length) {
                addRow();
            }

            while (col >= $("tbody").children()[0].children.length) {
                addCol();
            }

            $("tbody").children()[row].children[col].className = "live";
        }
    }
    </script>
</body>
</html>
